(function(window, angular, undefined) {
'use strict';
angular.module("keepr.ngOfflineModel",[]),angular.module("keepr.ngOfflineModel").service("CryptoOfflineStorage",function(){var loadCrypto="undefined"!=typeof CryptoJS;return{secret:"",storageType:"localStorage",init:function(opts){angular.extend(this,opts)},encrypt:function(object,secret){var message=loadCrypto?JSON.stringify(object):object;return loadCrypto?CryptoJS.TripleDES.encrypt(message,secret):JSON.stringify(object)},decrypt:function(encrypted,secret){if("undefined"==typeof encrypted)return"";var decrypted=loadCrypto?CryptoJS.TripleDES.decrypt(encrypted,secret):JSON.parse(encrypted);return loadCrypto?JSON.parse(decrypted.toString(CryptoJS.enc.Utf8)):decrypted},get:function(key){var encrypted=window[this.storageType].getItem(key);return encrypted&&this.decrypt(encrypted,this.secret)},set:function(key,object){if(!object)return this.remove(key),!1;var encrypted=this.encrypt(object,this.secret);return window[this.storageType].setItem(key,encrypted),!0},remove:function(key){return window[this.storageType].removeItem(key),!0}}}),angular.module("keepr.ngOfflineModel").factory("ngOfflineModel",function(CryptoOfflineStorage){var maxListItems=function(input,elementKey){var out;if(input){(void 0===elementKey||null===elementKey)&&(elementKey=!1);for(var i in input)elementKey?"undefined"!=typeof input[i][elementKey]&&(input[i][elementKey]>out||void 0===out||null===out)&&(out=input[i][elementKey]):(input[i]>out||void 0===out||null===out)&&(out=input[i]);return out}},_key=null,_items=null,_fields=null;return{_secret:"my-awesome-key",init:function(key,_items,fields,params){var self=this;_fields=fields||null,_key=key,params=params||{},angular.extend(self,params),CryptoOfflineStorage.init({secret:self._secret});var _itemsCached=CryptoOfflineStorage.get(_key);if(null!==_itemsCached?_items=_itemsCached:angular.isArray(_items)||(_items=[]),null!==_fields)for(var _itemsLength=_items.length,i=0;_itemsLength>i;i++)_items[i]=this.createValueObject(_items[i]);return CryptoOfflineStorage.set(_key,_items),self.setListItems(_items,params),self},createValueObject:function(item){var obj={};return angular.forEach(_fields,function(field){obj[field]=item[field]||""}),obj},setKey:function(key){return _key=key,this},getKey:function(){return _key},setListItems:function(items){return _items=items,this},getListItems:function(){return _items},setFields:function(fields){return _fields=fields,this},countTotalItems:function(items){return(maxListItems(items,"_id")||0)+1},create:function(item){return item=this.createValueObject(item),item._id=this.countTotalItems(_items),_items.push(item),CryptoOfflineStorage.set(_key,_items),_items},update:function(item){var self=this;return _items=_items.map(function(element){return element._id===item._id&&(element=self.createValueObject(item)),element}),CryptoOfflineStorage.set(_key,_items),_items},"delete":function(index){var db=this.getListItems(),_id=db.filter(function(element,pos){return element._id===index?(element.pos=pos,element):void 0});if(_id.length>0){var item=db.splice(_id[0].pos,1);if("object"==typeof item[0])return this.setListItems(db),CryptoOfflineStorage.set(_key,db),item[0]}return!1}}});
})(window, window.angular);